<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css" />
    <link rel="stylesheet" type="text/css" href="{{ static('css/portal/manage.css') }}" />
    <link rel="icon" href="{{ static('/images/_voxelfox/logo.png') }}" />
    <title>Voxel Fox Payment Portal - Manage</title>
</head>
<body>
<div id="payment-details">
    <input type="hidden" name="stripe-id" value="{{ stripe_id }}" />
    <input type="hidden" name="paypal-id" value="{{ paypal_id }}" />
    <input type="hidden" name="paypal-client-id" value="{{ paypal_client_id }}" />
    <input type="hidden" name="paypal-client-secret" value="{{ paypal_client_secret }}" />
</div>
<div class="content">

{% for item in items %}
    <div class="checkout-item" data-id="{{ item.id }}">
        <div class="field">
            <label class="label">Item ID (<a href="/portal/item/{{ item['id'] }}">product link</a>) (<a href="/portal/{{ item['product_group'] }}">group link</a>)</label>
            <input class="input" type="text" name="id" value="{{ item['id'] }}" disabled />
        </div>
        <div class="field">
            <label class="label">Name</label>
            <input class="input" type="text" name="product-name" value="{{ item['product_name'] or '' }}" required />
        </div>
        <div class="field">
            <label class="label">Description</label>
            <textarea class="textarea" name="description">{{ item['description'] or '' }}</textarea>
        </div>
        <div class="field">
            <label class="label">Product Group</label>
            <input class="input" type="text" name="product-group" value="{{ item['product_group'] or '' }}" />
        </div>
        <div class="field">
            <label class="label">Success URL</label>
            <input class="input" type="text" name="success-url" value="{{ item['success_url'] or '' }}" required />
        </div>
        <div class="field">
            <label class="label">Cancel URL</label>
            <input class="input" type="text" name="cancel-url" value="{{ item['cancel_url'] or '' }}" required />
        </div>
        <div class="field">
            <label class="label">Stripe Product ID</label>
            <input class="input" type="text" name="stripe-product-id" value="{{ item['stripe_product_id'] or '' }}" required />
        </div>
        <div class="field">
            <label class="label">Stripe Price ID</label>
            <input class="input" type="text" name="stripe-price-id" value="{{ item['stripe_price_id'] or '' }}" required />
        </div>
        <div class="field">
            <label class="label">PayPal Plan ID</label>
            <input class="input" type="text" name="paypal-plan-id" value="{{ item['paypal_plan_id'] or '' }}" />
        </div>
        <button class="button is-success" name="submit" onclick="submitEdits(this.parentNode.dataset.id);">Submit Edits</button>
    </div>
{% endfor %}

<script type="text/javascript">
async function submitEdits(itemId) {
    node = document.querySelector(`.checkout-item[data-id="${itemId}"]`);
    button = node.querySelector('[name="submit"]');
    button.disabled = true;
    site = await fetch(
        "/api/portal/update",
        {
            method: "PATCH",
            body: JSON.stringify({
                id: node.querySelector('[name="id"]').value,
                product_name: node.querySelector('[name="product-name"]').value,
                description: node.querySelector('[name="description"]').value,
                product_group: node.querySelector('[name="product-group"]').value,
                success_url: node.querySelector('[name="success-url"]').value,
                cancel_url: node.querySelector('[name="cancel-url"]').value,
                stripe_product_id: node.querySelector('[name="stripe-product-id"]').value,
                stripe_price_id: node.querySelector('[name="stripe-price-id"]').value,
                paypal_plan_id: node.querySelector('[name="paypal-plan-id"]').value,
            }),
        },
    );
    button.disabled = false;
}
</script>

</div>
</body>
